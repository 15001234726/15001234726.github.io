---
layout:     post
title:      Redis
subtitle:   Redis
date:       2020-03-29
author:     JYH
header-img: img/post-bg-swift.jpg
catalog: true
tags:
    - Redis
---

# Redis

## 一.为什么用redis

使用redis主要考虑两个问题，性能和并发。

### 1.性能

在并发高的情况下，所有请求直接访问数据库，数据库会出现连接异常。用Redis做一个缓冲操作，让请求先访问Redis而不是数据库。

![](https://shadowpriest.oss-cn-beijing.aliyuncs.com/githubio/%E6%88%AA%E5%B1%8F2019-10-1517.19.41.png)



### 2.并发

![](https://shadowpriest.oss-cn-beijing.aliyuncs.com/githubio/%E6%88%AA%E5%B1%8F2019-10-1517.25.09.png)


## 二.redis优缺点

### 1.优点

①.性能优异

②.支持多种数据类型，操作方便。

③.支持数据持久化，支持AOF(append-only-file)和RDB快照(snapshotting)两种方式。

RDB:把当前内存中的数据集快照写入磁盘，恢复时将快照文件读到内存中。RDB分为自动触发和手动触发。

④.支持主从复制

### 2.缺点

①.不具备自动容错和恢复功能

②.存储的数据量和机器本身内存大小有关，需要提前预估和节约内存

③.单线程，单台服务器无法充分利用cpu


## 三.单线程redis为什么快

### 1.完全基于内存

### 2.数据结构简单

### 3.单线程

### 4.多路I/O复用模型，非阻塞IO

单个线程通过跟踪每个I/O流的状态，来管理多个I/O流。redis-client在操作的时候，会产生不同事件类型的socket。服务端有一段I/O多路复用程序，将socket放入队列中。
文件事件分派器，去队列中取然后转发到不同的事件处理器中。

### 5.底层模型不同

## 四.redis数据类型和使用场景

### 1.string

value可以是string也可以是数字

### 2.hash

是key-value的键值对集合，适合用于存储对象。

### 3.list

简单的字符串列表，按照插入顺序排序，可以添加元素到头或者尾

### 4.set

string类型的无序集合，通过哈希表实现，添加、删除、查找的时间复杂度都是O（1）

### 5.sorted set

比set多了一个权重参数score，集合中的元素能够按照score进行排列。

## 五.redis过期策略和内存淘汰机制

### redis采用的是定期删除+惰性删除策略。

定期删除：redis默认每100ms将随机抽取key检查是否过期。如果存在过期的key则删除，因此只采用定期删除的策略会
导致一些key到了过期时间而没有被删除。

惰性删除：在获取key的时候，redis会检查是否过期，如果设置了过期时间并且过期了，就会删除。

### 是定期删除+惰性删除存在的问题

如果定期删除没有删除key，也没有即使请求去获取key，惰性删除也没有生效，redis的内存会越来越高。那么就应该采用内存淘汰机制。

redis中有一行配置：

/# maxmemory-policy volatile-lru

这个就是配置内存淘汰策略的，当内存不足以容纳写入新数据时：

1.noeviction：新写入操作会报错。（不推荐）

2.allkeys-lru：移除最近最少使用的key。（推荐）

3.allkeys-random：随机移除key。（不推荐）

4.volatile-lru：在设置了过期时间的key空间中，移除最近最少使用的key。（这种一般是既当缓存，又做持久化存储的时候才使用）

5.volatile-random：在设置了过期时间的key空间中，随机移除key。（不推荐）

6.volatile-ttl：在设置了过期时间的key空间中，有更早过期时间的key优先移除。（不推荐）

没有设置过期时间的key，由于不满足先决条件，volatile-lru、volatile-random、volatile-ttl的策略行为和noeviction基本上一致。


## 六.redis和数据库双写一致性问题

## 七.如何应对缓存击穿和缓存雪崩

## 八.redis并发竞争key问题


#### 参考文章
https://blog.csdn.net/bjweimengshu/article/details/100911399